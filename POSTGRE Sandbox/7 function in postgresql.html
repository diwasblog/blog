<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dracula â€” A dark theme for Prism.js and 50+ apps</title>
  <link rel="stylesheet" href="../ASP Sandbox/css/bootstrap.css">
  <link rel="stylesheet" href="../ASP Sandbox/css/bootstrap-grid.css">
  <link rel="stylesheet" href="../ASP Sandbox/css/bootstrap-reboot.css">
  <link rel="stylesheet" href="../ASP Sandbox/css/dracula.css">
  <link rel="stylesheet" href="../ASP Sandbox/css/dracula-prism.css">
  <link rel="icon" type="image/x-icon" href="https://draculatheme.com/assets/img/favicon.ico">
</head>

<body>

  <div class="row">
    <div class="col-lg-6">
      <pre>
            <code class="language-sql">
                CREATE OR REPLACE FUNCTION public.fn_abc() RETURNS void  AS '
                    <!-- statement -->
                 ' LANGUAGE SQL
              </code>
              </pre>

    </div>

    <div class="col-lg-6">
      <pre>
            <code class="language-sql">
              //remove quote with $$   $$==> Better than ''
                CREATE OR REPLACE FUNCTION public.fn_abc() RETURNS void  AS $$
                <!-- statement -->
             $$ LANGUAGE SQL
           </code>
      </pre>
    </div>
  </div>

  <h2>Returning Single Value</h2>
  <div class='row'>

    <div class="col-lg-12">
      <pre>
              <code class="language-sql">
                  CREATE OR REPLACE FUNCTION public.fn_abc() RETURNS real  AS $$
                    SELECT MAX(unit_price) from tbl_product
                  $$ LANGUAGE SQL
             </code>
        </pre>
    </div>
  </div>

  <h2>Function with Parameter</h2>
  <div class='row'>

    <div class="col-lg-12">
      <pre>
                <code class="language-sql">
                    CREATE OR REPLACE FUNCTION public.fn_abc(user_id integer, name text) RETURNS real  AS $$

                      SELECT MAX(unit_price) from tbl_product where userid =user_id

                    $$ LANGUAGE SQL
               </code>
          </pre>
    </div>
  </div>



  <h2>Function returning more than one row</h2>
  <div class='row'>

    <div class="col-lg-12">
      <pre>
                <code class="language-sql">
                    CREATE OR REPLACE FUNCTION public.fn_abc(user_id integer, name text) 
                    RETURNS TABLE(unit_price real, unit_name text) AS $$

                      SELECT unit_price,unit_name from tbl_product where userid =user_id
                      
                    $$ LANGUAGE SQL
               </code>
          </pre>
    </div>
  </div>

  <pre>
  <code class="language-sql">
CREATE OR REPLACE FUNCTION public.fn_getclientcommodityinpercent(
  data1 integer,
  data2 text)
    RETURNS TABLE(name text, y numeric)      // return name and numeric
    LANGUAGE 'plpgsql' // instead of LANGUAGE 'sql'

    COST 100
    VOLATILE 
    ROWS 1000
AS $BODY$

// your select query here
//select * from tble t where t.id =data1

$BODY$;

ALTER FUNCTION public.fn_getclientcommodityinpercent(data1 integer,data2 text)
    OWNER TO postgres;
  </code>
</pre>




  <h2></h2>
  <pre>
    <code class="language-csharp">
      using AITC_KCCIS.DataContext;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Web;

namespace AITC_KCCIS.Execution
{
	public class Execute_Query
	{
		AITC_KCCISDbContext db;
		public Execute_Query()
		{
			db = new AITC_KCCISDbContext();
		}
		public List<T> ExecuteFunction<T>(string commandName, List<object> param)
		{
			var flag = false;
			StringBuilder strBuilder = new StringBuilder();
			strBuilder.Append($"SELECT * FROM {commandName} (");
			foreach (var val in param)
			{
				flag = true;
				Type t = val.GetType();
				if (t.Equals(typeof(string)) || t.Equals(typeof(DateTime)))
				{
					strBuilder.Append("'" + val + "',");
				}
				else
				{
					strBuilder.Append(val + ",");
				}
			}
			var s = strBuilder.ToString();
			if (flag)
			{
				s = s.Substring(0, s.Length - 1);
			}
			s += ")";

			db.Database.CommandTimeout = 120 * 60;
			return db.Database.SqlQuery<T>(s).ToList();
		}

		public List<T> ExecuteFunction<T>(string commandName)
		{
			StringBuilder strBuilder = new StringBuilder();
			strBuilder.Append($"SELECT * FROM {commandName} (");

			var s = strBuilder.ToString();

			s += ")";

			db.Database.CommandTimeout = 120 * 60;
			return db.Database.SqlQuery<T>(s).ToList();
		}


	}
}
    </code>
  </pre>


  <h2>Passing Value </h2>
  <pre>
    <code class="language-csharp">
      Execute_Query query = new Execute_Query();
			var data = query.ExecuteFunction<fn_getclientcommodityinpercent>("fn_getclientcommodityinpercent", new List<object> { startDate.ToString("yyyy-MM-dd"), toDate.ToString("yyyy-MM-dd")}).ToList(); 
    </code>
  </pre>



  <h2>Without Passing Value </h2>
  <pre>
    <code class="language-csharp">
      Execute_Query query = new Execute_Query();
			var data = query.ExecuteFunction<fn_test>("fn_test", new List<object>()).ToList(); 
    </code>
  </pre>


  <br>
  <h2>Pagination</h2>
  <pre>
    <code class="language-csharp">
      SELECT count(case_reg.id) OVER() AS total_case_registration,id ,contact_no
FROM case_registration case_reg
where Lower(case_reg.first_name) like concat('%',name,'%') or  case_reg.first_name = ''
offset ((pageno-1)*pagesize) rows  fetch next (pagesize) rows only;
    </code>
  </pre>


  <script src="../ASP Sandbox/js/prism.js"></script>
  <script type="text/javascript">
    Prism.plugins.NormalizeWhitespace.setDefaults(
      {
        'remove-trailing': true,
        'remove-indent': true,
        'left-trim': true,
        'right-trim': true,
        // 'break-lines': 10,
        // 'indent': 2,
        // 'remove-initial-line-feed': false,
        // 'tabs-to-spaces': 4,
        // 'spaces-to-tabs': 4
      });
  </script>
</body>

</html>