<p><span style="font-size: 18pt; font-family: verdana, geneva, sans-serif;"><strong>XSRF</strong></span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;">XSRF Attack is the third popular attack after <span style="color: #000000;"><strong>SQL Injection</strong></span> and <span style="color: #000000;"><strong>XSS</strong></span>.</span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;">Cross site request forgery (CSRF), also known as <strong><span style="color: #ff0000;">XSRF</span></strong>, <strong><span style="color: #ff0000;">Sea Surf</span></strong> or <strong><span style="color: #ff0000;">Session Riding.</span></strong></span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;"><strong><span style="color: #ff0000;">Called Session Riding <span style="color: #000000;">because the attack takes advantage of the user's previously authenticated session.</span></span></strong></span></p>
<p><br /><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;">A CSRF attack simply takes advantage of the fact that the browser sends the <strong><span style="color: #ff0000;">authentication cookie</span></strong> of the resource to the website automatically with <strong><span style="color: #ff0000;">each request</span></strong>.</span></p>
<p><span style="color: #000000;"><strong><span style="font-family: verdana, geneva, sans-serif; font-size: 18pt;">There are two ways of executing this attack:</span></strong></span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;">&nbsp;1) The first one is tricking the victim into<span style="color: #000000;"><strong> clicking a link or loading a page</strong></span>. This is normally done through social engineering and malicious links.</span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;">2) The second part is sending a crafted, legitimate-looking request from the victim&rsquo;s browser to the website. </span><br /><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;">The request is sent with values chosen by the attacker including any cookies that the victim was associated with that website. </span><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;">This way, the website knows that this victim can perform certain actions on the website. Any request sent with these HTTP credentials </span><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;">or cookies will be considered legitimate, even though the victim would be sending the request on the attacker&rsquo;s command.</span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;"><img class="img-responsive" src="https://www.dotnetcurry.com/images/aspnet/core-csrf/csrf-overview.png" alt="" width="850" height="602" /></span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 24pt; color: #000000;">When CSRF Attack will not happen?</span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;">If you don't use a <span style="color: #000000;"><strong>session-based authentication cookie</strong></span>, then<strong><span style="color: #000000;"> there's no CSRF attack possible</span></strong>.<br />CSRF attacks are only feasible/possible when a browser sends an authentication token automatically with every request<br /></span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;">AntiForgery is used to protect against CSRF Attack.</span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 24pt;">How User can guard against this attack ?</span></p>
<p><span style="font-size: 12pt;">Users can guard against CSRF vulnerabilities by taking precautions:</span></p>
<ul>
<li><span style="font-size: 12pt;">Sign off of web apps when finished using them.</span></li>
<li class=""><span style="font-size: 12pt;">Clear browser cookies periodically.</span></li>
<li class=""><span style="font-size: 12pt;">By using AntiForgery</span></li>
</ul>
<p><span style="font-size: 12pt;"><strong><span style="color: #ff0000;">In Cookies Based Authentication</span> </strong>: When a user authenticates using their <strong><span style="color: #000000;">username</span> </strong>and <strong><span style="color: #000000;">password</span></strong>, they're<span style="color: #000000;"><strong> issued a token</strong></span>, containing an authentication ticket that can be used for authentication and authorization. <strong><span style="color: #000000;">The token is stored as a cookie</span></strong> that is send on every request the client makes.Generating and validating this cookie is performed by the Cookie Authentication Middleware in asp.net core.</span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;"><strong><span style="color: #ff0000;">In Token Based Authentication</span></strong>: When a user is authenticated, they're issued a token (not an antiforgery token). The token contains user information in the form of&nbsp;<a href="https://docs.microsoft.com/en-us/dotnet/framework/security/claims-based-identity-model" data-linktype="absolute-path">claims</a>&nbsp;or a reference token that points the app to user state maintained in the app. When a user attempts to access a resource requiring authentication, the token is sent to the app with an additional authorization header in form of Bearer token. This makes the app stateless. In each subsequent request, the token is passed in the request for server-side validation.</span></p>
<p><span style="font-family: verdana, geneva, sans-serif; font-size: 12pt;"><strong><span style="color: #ff0000;">Note:</span> </strong>To send the token on subsequent requests, mainly tokens are stored in the<strong><span style="color: #ff0000;"> browser's local storage</span></strong>.If token is stored in local storage of browser then it will not be concerned with CSRF Vulnerablity .CSRF is only concern when the token is stored in a<span style="color: #ff0000;"><strong> cookie storage.</strong></span></span></p>
<p><span style="color: #000000;"><strong><span style="font-size: 18pt;">How to Antiforgery prevention works?</span></strong></span></p>
<p style="text-align: justify;"><span style="font-size: 12pt;"><span style="font-family: verdana, geneva, sans-serif;">For each user session, logged-in or otherwise, the <strong><span style="color: #000000;">asp.net&nbsp; server</span></strong> generates <strong><span style="color: #000000;">a unique token</span></strong> and stores that in the <span style="color: #000000;"><strong>session cookie</strong></span>, which is additionally <a href="http://en.wikipedia.org/wiki/Digital_signature" target="_blank" rel="noopener">digitally signed</a>&nbsp;server-side to detect tampering. The server then places <span style="color: #000000;"><strong>this token as a hidden field</strong></span> into every form on every page that it renders. If a user submits the form normally, say, by clicking the &ldquo;Submit&rdquo; button, the token will be sent to the server<span style="color: #000000;"><strong> as a form parameter,</strong></span> as well as<span style="color: #000000;"><strong> in the cookie.</strong></span> The server then checks to see that the <strong><span style="color: #000000;">token in the cookie matches the token in the form parameter</span></strong>. If they don&rsquo;t match, the request is assumed to be <strong><span style="color: #ff0000;">forged</span></strong>, the action is not performed, and the <strong><span style="color: #000000;">user is forcibly logged out.</span></strong> This only works on POST requests, so it is also up to you to ensure that all of the important actions that can be performed on your site are POST requests</span>.</span></p>
<p style="text-align: justify;"><span style="font-size: 14pt;">This CSRF protection method is called the<strong><span style="color: #ff0000;">&nbsp;<em>synchronizer token pattern</em></span></strong>. It protects the form against Cross-site Request Forgery attacks because an attacker would also need to guess the exact token present in the form(also if victim create the token in his generated form then also it is impossible to get exact token present in the real form)&nbsp; to successfully trick a victim into sending a valid request. The token should also be invalidated after some time and after the user logs out</span></p>
<p style="text-align: justify;">&nbsp;</p>
<p style="text-align: justify;"><span style="font-size: 14pt;">Conclusion</span></p>
<p style="text-align: justify;"><span style="font-size: 14pt;">Cookies are intrinsically vulnerable to CSRF because they are automatically sent with each request. This allows attackers to easily craft malicious requests that lead to CSRF. <span style="color: #000000;"><strong>Although the attacker cannot obtain th<span style="color: #ff0000;">e response body or the cookie</span> itself, they can perform actions with the victim&rsquo;s elevated rights</strong></span>. The impact of a CSRF vulnerability is related to the privileges of the victim.&nbsp;</span></p>
<p style="text-align: justify;">&nbsp;</p>
<p style="text-align: justify;">&nbsp;</p>


================================================================================================

<p><strong><span style="font-size: 14pt;">Open Redirect Attack( or Unvalidated Redirects and Forwards)</span></strong></p>
<p style="text-align: justify;"><span style="font-size: 12pt; font-family: verdana, geneva, sans-serif;">A web app that redirects to a URL that's specified via the request such as the <strong><span style="color: #000000;">querystring</span> </strong>or form data can potentially be tampered with to redirect users to an <strong><span style="color: #000000;">external</span></strong>, <strong><span style="color: #000000;">malicious URL.</span> </strong>This tampering is called an <span style="color: #ff0000;"><strong>open redirection attack.</strong></span></span></p>
<p style="text-align: justify;"><span style="font-size: 12pt; font-family: verdana, geneva, sans-serif; color: #333333;">Whenever your application logic <strong>redirects </strong>to a specified URL, you must verify that the redirection URL hasn't been tampered with. ASP.NET Core has built-in functionality to help protect apps from open redirect (also known as open redirection) attacks.</span></p>
<h2 id="what-is-an-open-redirect-attack"><span style="font-family: impact, sans-serif; color: #333333;">What is an open redirect attack?</span></h2>
<p class=""><span style="font-size: 12pt;">Web applications frequently redirect users to a login page when they access resources that require authentication. The redirection typically includes a&nbsp;<code class="">returnUrl</code>&nbsp;querystring parameter so that the user can be returned to the originally requested URL after they have successfully logged in. After the user authenticates, they're redirected to the URL they had originally requested.</span></p>
<p class=""><span style="font-size: 12pt;">Because the destination URL is specified in the querystring of the request, a malicious user could tamper with the querystring. A tampered querystring could allow the site to redirect the user to an external, malicious site. This technique is called an open redirect (or redirection) attack.</span></p>
<h3 id="an-example-attack" class="">An example attack</h3>
<p><span style="font-size: 12pt; font-family: verdana, geneva, sans-serif;">A malicious user can develop an attack intended to allow the malicious user access to a user's credentials or sensitive information. To begin the attack, the malicious user convinces the user to click a link to your site's login page with a&nbsp;<code>returnUrl</code>&nbsp;querystring value added to the URL. For example, consider an app at&nbsp;<code>contoso.com</code>&nbsp;that includes a login page at<strong><span style="color: #ff0000;">&nbsp;<code>http://contoso.com/Account/LogOn?returnUrl=/Home/About</code></span></strong>. The attack follows these steps:</span></p>
<ol>
<li class=""><span style="font-size: 12pt; font-family: verdana, geneva, sans-serif;">The user clicks a malicious link to<strong><span style="color: #333333;">&nbsp;<span style="color: #ff0000;"><code>http://contoso.com/Account/LogOn?returnUrl=http://contoso1.com/Account/LogOn</code></span></span></strong><span style="color: #ff0000;">&nbsp;</span>(the second URL is "<span style="color: #000000;"><strong>contoso1.com</strong></span>", not "<strong><span style="color: #000000;">contoso.com</span></strong>").</span></li>
<li class=""><span style="font-size: 12pt; font-family: verdana, geneva, sans-serif;">The user logs in successfully.</span></li>
<li class=""><span style="font-size: 12pt; font-family: verdana, geneva, sans-serif;">The user is redirected (by the site) to&nbsp;<strong><span style="color: #000000;"><code>http://contoso1.com/Account/LogOn</code></span></strong>&nbsp;(a malicious site that looks exactly like real site).</span></li>
<li><span style="font-size: 12pt; font-family: verdana, geneva, sans-serif;">The user logs in again (giving malicious site their credentials) and is redirected back to the real site.</span></li>
</ol>
<p class=""><span style="font-size: 12pt; font-family: verdana, geneva, sans-serif;">The user likely believes that their first attempt to log in failed and that their second attempt is successful. The user most likely remains unaware that their credentials are compromised.</span></p>
<p class=""><span style="font-size: 12pt; font-family: verdana, geneva, sans-serif;">If website doesn't validate the "<strong><span style="color: #ff0000;"><code>returnUrl</code></span></strong>" parameter value to make sure that target web page is legitimate and intended, attacker could manipulate that parameter to send a victim to a fake page crafted by attacker: <strong><span style="color: #333333;"><span style="color: #ff0000;"><code>http://contoso.com/Account/LogOn?returnUrl=http://contoso1.com/Account/LogOn</code></span></span></strong></span></p>
<p class=""><span style="font-size: 12pt; font-family: verdana, geneva, sans-serif;"><img class="img-responsive" src="https://www.netsparker.com/statics/img/blogposts/exploiting_open_redirectionpng.png" alt="" width="915" height="336" /></span></p>