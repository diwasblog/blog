<!DOCTYPE html>
<html>
<head>
</head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dracula â€” A dark theme for Prism.js and 50+ apps</title>
<link rel="stylesheet" href="../css/bootstrap.css">
<link rel="stylesheet" href="../css/bootstrap-grid.css">
<link rel="stylesheet" href="../css/bootstrap-reboot.css">
<link rel="stylesheet" href="../css/dracula.css">
<link rel="stylesheet" href="../css/dracula-prism.css">
<link rel="icon" type="image/x-icon" href="https://draculatheme.com/assets/img/favicon.ico">
<body>
<ol>
<li><span style="font-size: 12pt;">Introduced <span style="color: #ff0000;">after EF 6.x</span></span></li>
<li><span style="font-size: 12pt;"><span style="color: #ff0000;"><strong>Open Source</strong></span> and <span style="color: #ff0000;"><strong>Cross Platform ORM</strong></span></span></li>
<li><span style="font-size: 12pt;">Enhancement to ADO.NET that gives developers an automated mechanism for accessing &amp; storing the data in the database.</span></li>
<li><span style="font-size: 12pt;">EF Core is intended to be used with <strong><span style="color: #ff0000;">.NET Core applications</span> </strong>but also work in .Net 4.5+.</span></li>
</ol>
<table class="table table-striped table-bordered table-condensed" style="width: 301px;">
<thead>
<tr style="background: black; color: white;">
<th style="width: 168px;">EF Core Version</th>
<th style="width: 131px;">Release Date</th>
</tr>
</thead>
<tbody>
<tr>
<td style="width: 168px;">EF Core 2.0</td>
<td style="width: 131px;">August 2017</td>
</tr>
<tr>
<td style="width: 168px;">EF Core 1.1</td>
<td style="width: 131px;">November 2016</td>
</tr>
<tr>
<td style="width: 168px;">EF Core 1.0</td>
<td style="width: 131px;">June 2016</td>
</tr>
</tbody>
</table>
<p><em><span style="text-decoration: underline;"><strong><span style="font-size: 18pt; color: #ff0000; text-decoration: underline;">EF Core Work with both </span></strong></span></em></p>
<p><strong><span style="font-size: 14pt;">1) Code-First&nbsp; (Targeting this)</span></strong></p>
<p><strong><span style="font-size: 14pt;">2) Database-First.</span></strong></p>
<p><span style="font-size: 14pt;">In the <strong><span style="color: #ff0000;">code-first approach</span></strong>, EF Core API creates the database and tables using migration based on the conventions and configuration provided in your domain classes.</span></p>
<p><span style="font-size: 14pt;">In the <strong><span style="color: #ff0000;">database-first approach</span></strong>, EF Core API creates the domain and context classes based on your existing database using EF Core commands.(But has limited supports).</span></p>
<p><span style="text-decoration: underline;"><strong><span style="font-size: 18pt;">EF Core doesnot supports </span></strong></span></p>
<ol>
<li><strong><span style="font-size: 12pt;">lazyloading</span></strong></li>
<li><strong><span style="font-size: 12pt;">,Automated Migration,</span></strong></li>
<li><strong><span style="font-size: 12pt;">Many-to-Many without join entity,</span></strong></li>
<li><strong><span style="font-size: 12pt;">Seed data,</span></strong></li>
<li><strong><span style="font-size: 12pt;">Stored procedure mapping with DbContext for CUD operation,</span></strong></li>
<li><strong><span style="font-size: 12pt;">Spatial Data ,</span></strong></li>
<li><strong><span style="font-size: 12pt;"> No visual designer</span></strong></li>
</ol>
<h2 id="efcore-db-providers"><span style="color: #ff00ff;"><strong>EF Core Database Providers</strong></span></h2>
<ol>
<li><span style="font-size: 12pt;">MS SQL</span></li>
<li><span style="font-size: 12pt;">PostGre</span></li>
<li><span style="font-size: 12pt;">SQLITe</span></li>
<li><span style="font-size: 12pt;">In-memory</span></li>
<li><span style="font-size: 12pt;">MYSQL</span></li>
</ol>
<p><span style="color: #ff0000;"><strong><span style="font-size: 18pt;">To use EF Core we need to install</span></strong></span></p>
<p><span style="font-size: 18.6667px;">1)<strong>Database Provider&nbsp;</strong> (to access database)</span></p>
<p><span style="font-size: 18.6667px;">&nbsp; &nbsp; &nbsp; eg.<span style="color: #ff0000;">Microsoft.EntityFrameworkCore.SqlServer&nbsp;&nbsp;</span></span></p>
<p><span style="font-size: 18.6667px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Microsoft.EntityFrameworkCore.Relational and System.Data.SqlClient are installed as dependencies automatically</span></p>
<p><span style="font-size: 14pt;">2)<strong>EF Core tools</strong></span></p>
<p><span style="font-size: 14pt;">To execute EF Core commands like scaffolding and migration via package manager</span></p>
<p><span style="color: #ff0000;"><strong><span style="font-size: 14pt;">Microsoft.EntityFrameworkCore.Tools</span></strong></span></p>
<p><span style="color: #ff0000;"><strong><span style="font-size: 14pt;">===================================================================================</span></strong></span></p>
<p><span style="color: #ff00ff; font-size: 24pt;"><strong>Database First Approach</strong></span></p>
<p><span style="color: #000000; font-size: 12pt;">EF Core doesnot support Visual Designer.</span></p>
<p><span style="color: #000000; font-size: 12pt;"><strong><span style="color: #ff0000;">Scaffold-DbContext&nbsp;</span> command is used to create entity and class from existing database</strong></span></p>
<p><span style="font-size: 18.6667px;">&nbsp;</span></p>

<img src="img/entityrelation2.png">

<p>Create this database table first then create this connection as below</p>
<pre><span style="background-color: #ffffff;"><code>Syntax: Scaffold-DbContext [-Connection] [-Provider] [-OutputDir] [-Context] [-Schemas&gt;] [-Tables&gt;] 
                    [-DataAnnotations] [-Force] [-Project] [-StartupProject] [&lt;CommonParameters&gt;]</code></span><br /><br /></pre>
<pre><strong><span style="font-size: 12pt;"><code><span style="background-color: #ffffff;">Scaffold-DbContext "Server=.\SQLExpress;Database=SchoolDB;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Model</span>s</code></span><br /><br /><code>-<span style="color: #ff0000;">OutputDir</span></code>&nbsp;parameter specifies the directory where we want to generate all the classes which is the Models folder in this case.<br /><br />-<span style="color: #ff0000;">Provider</span> parameter here is <code><span style="background-color: #ffffff;">Microsoft.EntityFrameworkCore.SqlServer</span></code><br /><br /></strong></pre>
<p><code>Scaffold-DbContext</code>&nbsp;command creates entity classes for each table in the&nbsp;<code>SchoolDB</code>&nbsp;database and context class (by deriving&nbsp;<code>DbContext</code>) with Fluent API configurations for all the entities in the Models folder.</p>

When you execute that command this model is generated as below:
<br>
<img src="img/dbfirst-model.png">
<br>
Then Student Model looks like this
<br>

<pre>
  <code class="language-csharp">
    using System;
using System.Collections.Generic;

namespace EFCoreTutorials.Models
{
    public partial class Student
    {
        public Student()
        {
            StudentCourse = new HashSet&lt;StudentCourse>();
        }

        public int StudentId { get; set; }
        public string FirstName { get; set; }
        public string LastName { get; set; }
        public int? StandardId { get; set; }

        public Standard Standard { get; set; }  //Student and Standard One to One Relation
        public StudentAddress StudentAddress { get; set; } //Student and StudentAddress One to One Relation
        public ICollection&lt;StudentCourse> StudentCourse { get; set; } //Student and StudentCourse One to Many Relation
    }
}
  </code>
</pre>

<h2>This is StudentDbContext class use to store and retrieve data from db</h2>
<pre>
  <code class="language-csharp">
    using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Metadata;

namespace EFCoreTutorials.Models
{
    public partial class SchoolDBContext : DbContext
    {
        public virtual DbSet&lt;Course> Course { get; set; }
        public virtual DbSet&lt;Standard> Standard { get; set; }
        public virtual DbSet&lt;Student> Student { get; set; }
        public virtual DbSet&lt;StudentAddress> StudentAddress { get; set; }
        public virtual DbSet&lt;StudentCourse> StudentCourse { get; set; }
        public virtual DbSet&lt;Teacher> Teacher { get; set; }

        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        {
            if (!optionsBuilder.IsConfigured)
            {
#warning To protect potentially sensitive information in your connection string, you should move it out of source code. See http://go.microsoft.com/fwlink/?LinkId=723263 for guidance on storing connection strings.
                optionsBuilder.UseSqlServer(@"Server=.\SQLExpress;Database=SchoolDB;Trusted_Connection=True;");
            }
        }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            modelBuilder.Entity&lt;Course>(entity =>
            {
                entity.Property(e => e.CourseName)
                    .HasMaxLength(50)
                    .IsUnicode(false);

                entity.HasOne(d => d.Teacher)
                    .WithMany(p => p.Course)
                    .HasForeignKey(d => d.TeacherId)
                    .OnDelete(DeleteBehavior.Cascade)
                    .HasConstraintName("FK_Course_Teacher");
            });

            modelBuilder.Entity&lt;Standard>(entity =>
            {
                entity.Property(e => e.Description)
                    .HasMaxLength(50)
                    .IsUnicode(false);

                entity.Property(e => e.StandardName)
                    .HasMaxLength(50)
                    .IsUnicode(false);
            });

            modelBuilder.Entity&lt;Student>(entity =>
            {
                entity.Property(e => e.StudentId).HasColumnName("StudentID");

                entity.Property(e => e.FirstName)
                    .HasMaxLength(50)
                    .IsUnicode(false);

                entity.Property(e => e.LastName)
                    .HasMaxLength(50)
                    .IsUnicode(false);

                entity.HasOne(d => d.Standard)
                    .WithMany(p => p.Student)
                    .HasForeignKey(d => d.StandardId)
                    .OnDelete(DeleteBehavior.Cascade)
                    .HasConstraintName("FK_Student_Standard");
            });

            modelBuilder.Entity&lt;StudentAddress>(entity =>
            {
                entity.HasKey(e => e.StudentId);

                entity.Property(e => e.StudentId)
                    .HasColumnName("StudentID")
                    .ValueGeneratedNever();

                entity.Property(e => e.Address1)
                    .IsRequired()
                    .HasMaxLength(50)
                    .IsUnicode(false);

                entity.Property(e => e.Address2)
                    .HasMaxLength(50)
                    .IsUnicode(false);

                entity.Property(e => e.City)
                    .IsRequired()
                    .HasMaxLength(50)
                    .IsUnicode(false);

                entity.Property(e => e.State)
                    .IsRequired()
                    .HasMaxLength(50)
                    .IsUnicode(false);

                entity.HasOne(d => d.Student)
                    .WithOne(p => p.StudentAddress)
                    .HasForeignKey&lt;StudentAddress>(d => d.StudentId)
                    .HasConstraintName("FK_StudentAddress_Student");
            });

            modelBuilder.Entity&lt;StudentCourse>(entity =>
            {
                entity.HasKey(e => new { e.StudentId, e.CourseId });

                entity.HasOne(d => d.Course)
                    .WithMany(p => p.StudentCourse)
                    .HasForeignKey(d => d.CourseId)
                    .OnDelete(DeleteBehavior.ClientSetNull)
                    .HasConstraintName("FK_StudentCourse_Course");

                entity.HasOne(d => d.Student)
                    .WithMany(p => p.StudentCourse)
                    .HasForeignKey(d => d.StudentId)
                    .HasConstraintName("FK_StudentCourse_Student");
            });

            modelBuilder.Entity&lt;Teacher>(entity =>
            {
                entity.Property(e => e.StandardId).HasDefaultValueSql("((0))");

                entity.Property(e => e.TeacherName)
                    .HasMaxLength(50)
                    .IsUnicode(false);

                entity.HasOne(d => d.Standard)
                    .WithMany(p => p.Teacher)
                    .HasForeignKey(d => d.StandardId)
                    .OnDelete(DeleteBehavior.Cascade)
                    .HasConstraintName("FK_Teacher_Standard");
            });
        }
    }
}

  </code>
</pre>
<p><strong><span style="font-size: 14pt; color: #ff0000;">Note:&nbsp;EF Core creates entity classes only for tables and not for StoredProcedures or Views.</span></strong></p>

<h1><strong><span style="color: #ff0000;">&nbsp;DbContext</span></strong></h1>
<p><span style="color: #000000; font-size: 14pt;"><strong>Then you must create <span style="color: #ff0000;">instance</span> of DbContext to represents a session with the database which can be used to query and save instances of your entities to a database.&nbsp;<code>DbContext</code>&nbsp;is a combination of the <span style="color: #ff0000;">Unit Of Work</span> and <span style="color: #ff0000;">Repository patterns.</span></strong></span></p>

<pre>
  <code class="language-csharp">
    public class SchoolContext : DbContext
{
    public SchoolContext()
    {
  
    }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
      optionsBuilder.UseSqlServer(@"Server=.\SQLEXPRESS;Database=SchoolDB;Trusted_Connection=True;");
    }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
    }
    //entities
    public DbSet&lt;Student> Students { get; set; }  //mapped to Student Table
    public DbSet&lt;Course> Courses { get; set; }    //mapped to Courses Table
}  
  </code>
</pre> -->

<p><span style="font-size: 12pt;"><code><strong>SchoolContext</strong></code>&nbsp;class is derived from the<strong><span style="color: #ff0000;">&nbsp;<code>DbContext</code>&nbsp;</span></strong>class and contains the&nbsp;<span style="color: #ff0000;"><strong><code>DbSet&lt;TEntity&gt;</code>&nbsp;</strong></span>properties of&nbsp;<strong><code>Student</code></strong>&nbsp;and&nbsp;<strong><code>Course</code></strong>&nbsp;type. It also overrides the<span style="color: #ff0000;"><strong>&nbsp;<code>OnConfiguring</code></strong></span>&nbsp;and&nbsp;<span style="color: #ff0000;"><strong><code>OnModelCreating</code>&nbsp;</strong></span>methods. We must create an <span style="color: #ff0000;"><strong>instance of&nbsp;<code>SchoolContext</code></strong></span>&nbsp;<strong>to connect to the database and save or retrieve&nbsp;<code>Student</code>&nbsp;or&nbsp;<code>Course</code>&nbsp;data.</strong></span></p>
<p><span style="font-size: 12pt;">The&nbsp;<code>OnConfiguring()</code>&nbsp;method allows us to select and configure the data source to be used with a context using&nbsp;<code>DbContextOptionsBuilder</code>.</span></p>


<h2>Then Writing to Table Student</h2>

<pre>
  <code clas="language-csharp">
    static void Main(string[] args)
        {
            using (var context = new SchoolContext()) {

                var std = new Student()
                {
                     Name = "Bill"
                };

                context.Students.Add(std);
                context.SaveChanges();
            }
        }
    }
  </code>
</pre>

<h2>Using Include </h2>
<div class="row">
    <div class="col">     
<pre>
    <code class="language-csharp">
var context = new SchoolContext();

var studentWithGrade = context.Students
                    .Where(s => s.FirstName == "Bill")
                    .Include(s => s.Grade)
                    .FirstOrDefault();
    </code>
  </pre>
    </div>

    <div class="col">
        OR     
        <pre>
            <code class="language-csharp">
var context = new SchoolContext();

var studentWithGrade = context.Students
                        .Where(s => s.FirstName == "Bill")
                        .Include("Grade")
                        .FirstOrDefault();
            </code>
          </pre>
            </div>
</div>
<h2> Its equivalent query :</h2>

<pre>
  <code class="language-csharp">
    SELECT TOP(1) [s].[StudentId], [s].[DoB], [s].[FirstName], [s].[GradeId],[s].[LastName], 
        [s].[MiddleName], [s.Grade].[GradeId], [s.Grade].[GradeName], [s.Grade].[Section]
    FROM [Students] AS [s]
    LEFT JOIN [Grades] AS [s.Grade] ON [s].[GradeId] = [s.Grade].[GradeId]
    WHERE [s].[FirstName] = N'Bill'
  </code>
</pre>
<br>
<h2>Multiple Include</h2>
<div class="row">
    <div class="col">
        <pre>
            <code class="language-csharp">
                var context = new SchoolContext();
            
                var studentWithGrade = context.Students.Where(s => s.FirstName == "Bill")
                                    .Include(s => s.Grade)
                                    .Include(s => s.StudentCourses)
                                    .FirstOrDefault();
            </code>
        </pre>
    </div>

    
</div>
<h2>Generated SQL(Execute two queries in One Round Trip)</h2>
<pre>
  <code class="language-csharp">
    SELECT TOP(1) [s].[StudentId], [s].[DoB], [s].[FirstName], [s].[GradeId], [s].[LastName], 
    [s].[MiddleName], [s.Grade].[GradeId], [s.Grade].[GradeName], [s.Grade].[Section]
FROM [Students] AS [s]
LEFT JOIN [Grades] AS [s.Grade] ON [s].[GradeId] = [s.Grade].[GradeId]
WHERE [s].[FirstName] = N'Bill'
ORDER BY [s].[StudentId]
Go

SELECT [s.StudentCourses].[StudentId], [s.StudentCourses].[CourseId]
FROM [StudentCourses] AS [s.StudentCourses]
INNER JOIN (
SELECT DISTINCT [t].*
FROM (
    SELECT TOP(1) [s0].[StudentId]
    FROM [Students] AS [s0]
    LEFT JOIN [Grades] AS [s.Grade0] ON [s0].[GradeId] = [s.Grade0].[GradeId]
    WHERE [s0].[FirstName] = N'Bill'
    ORDER BY [s0].[StudentId]
) AS [t]
) AS [t0] ON [s.StudentCourses].[StudentId] = [t0].[StudentId]
ORDER BY [t0].[StudentId]
Go
  </code>
</pre>
====================================================================================================================
<br>
<h2>Mulitple Include</h2>
<div class="row">
        <div class="col">
                <pre>
                    <code class="language-csharp">
                var context = new SchoolContext();
        
                var student = context.Students.Where(s => s.FirstName == "Bill")
                                        .Include(s => s.Grade)
                                            .ThenInclude(g => g.Teachers)
                                        .FirstOrDefault();
                    </code>
                </pre>
            </div>

            <div class="col">
                OR(Using Projection Property)
                    <pre>
                        <code class="language-csharp">
var context = new SchoolContext();

var stud = context.Students.Where(s => s.FirstName == "Bill")
                        .Select(s => new
                        {
                            Student = s,
                            Grade = s.Grade,
                            GradeTeachers = s.Grade.Teachers
                        })
                        .FirstOrDefault();
                        </code>
                    </pre>
                </div>
</div>
    <p><span style="font-size: 14pt;">In the above example,<strong>&nbsp;<span style="color: #ff00ff;"><code>.Include(s =&gt; s.Grade)</code></span></strong>&nbsp;will load the&nbsp;<strong><span style="color: #ff00ff;"><code>Grade</code>&nbsp;</span></strong>reference navigation property of the&nbsp;<code>Student</code>&nbsp;entity.&nbsp;<span style="color: #ff00ff;"><strong><code>.ThenInclude(g =&gt; g.Teachers)</code></strong></span>&nbsp;will load the&nbsp;<strong><span style="color: #ff00ff;"><code>Teacher</code></span></strong>&nbsp;collection property of the&nbsp;<code>Grade</code>&nbsp;entity. The&nbsp;<strong><code>T<span style="color: #ff00ff;">henInclude</span></code></strong><span style="color: #ff00ff;">&nbsp;</span>method must be called after the&nbsp;<strong><span style="color: #ff00ff;"><code>Include</code>&nbsp;</span></strong>method. The above will execute the following SQL queries in the database.</span></p>


    <h2>Generated SQL</h2>

    <pre>
        <code class="language-sql">
                SELECT TOP(1) [s].[StudentId], [s].[DoB], [s].[FirstName], [s].[GradeId], [s].[LastName],
                [s].[MiddleName], [s.Grade].[GradeId], [s.Grade].[GradeName], [s.Grade].[Section]
       FROM [Students] AS [s]
       LEFT JOIN [Grades] AS [s.Grade] ON [s].[GradeId] = [s.Grade].[GradeId]
       WHERE [s].[FirstName] = N'Bill'
       ORDER BY [s.Grade].[GradeId]
       Go
       
       SELECT [s.Grade.Teachers].[TeacherId], [s.Grade.Teachers].[GradeId], [s.Grade.Teachers].[Name]
       FROM [Teachers] AS [s.Grade.Teachers]
       INNER JOIN (
           SELECT DISTINCT [t].*
           FROM (
               SELECT TOP(1) [s.Grade0].[GradeId]
               FROM [Students] AS [s0]
               LEFT JOIN [Grades] AS [s.Grade0] ON [s0].[GradeId] = [s.Grade0].[GradeId]
               WHERE [s0].[FirstName] = N'Bill'
               ORDER BY [s.Grade0].[GradeId]
           ) AS [t]
       ) AS [t0] ON [s.Grade.Teachers].[GradeId] = [t0].[GradeId]
       ORDER BY [t0].[GradeId]
       go
        </code>
    </pre>
=================================================================================================================================
<table class="table table-striped table-bordered table-condensed" style="width: 594px;">
        <tbody>
        <tr style="background-color: black; color: red;">
        <th class="col-xs-4" style="width: 286px;">C# Data Type</th>
        <th class="col-xs-8" style="width: 306px;">Mapping to SQL Server Data Type</th>
        </tr>
        <tr>
        <td style="width: 286px;">int</td>
        <td style="width: 306px;">int</td>
        </tr>
        <tr>
        <td style="width: 286px;">string</td>
        <td style="width: 306px;">nvarchar(Max)</td>
        </tr>
        <tr>
        <td style="width: 286px;">decimal</td>
        <td style="width: 306px;">decimal(18,2)</td>
        </tr>
        <tr>
        <td style="width: 286px;">float</td>
        <td style="width: 306px;">real</td>
        </tr>
        <tr>
        <td style="width: 286px;">byte[]</td>
        <td style="width: 306px;">varbinary(Max)</td>
        </tr>
        <tr>
        <td style="width: 286px;">datetime</td>
        <td style="width: 306px;">datetime</td>
        </tr>
        <tr>
        <td style="width: 286px;">bool</td>
        <td style="width: 306px;">bit</td>
        </tr>
        <tr>
        <td style="width: 286px;">byte</td>
        <td style="width: 306px;">tinyint</td>
        </tr>
        <tr>
        <td style="width: 286px;">short</td>
        <td style="width: 306px;">smallint</td>
        </tr>
        <tr>
        <td style="width: 286px;">long</td>
        <td style="width: 306px;">bigint</td>
        </tr>
        <tr>
        <td style="width: 286px;">double</td>
        <td style="width: 306px;">float</td>
        </tr>
        <tr>
        <td style="width: 286px;">char</td>
        <td style="width: 306px;">No mapping</td>
        </tr>
        <tr>
        <td style="width: 286px;">sbyte</td>
        <td style="width: 306px;">No mapping (throws exception)</td>
        </tr>
        <tr>
        <td style="width: 286px;">object</td>
        <td style="width: 306px;">No mapping</td>
        </tr>
        </tbody>
        </table>

=================================================================================================================================        
<script src="../js/prism.js"></script>
<script type="text/javascript">
  Prism.plugins.NormalizeWhitespace.setDefaults(
    {
      'remove-trailing': true,
      'remove-indent': true,
      'left-trim': true,
      'right-trim': true,
      // 'break-lines': 10,
      // 'indent': 2,
      // 'remove-initial-line-feed': false,
      // 'tabs-to-spaces': 4,
      // 'spaces-to-tabs': 4
    });
</script>
</body>
</html>